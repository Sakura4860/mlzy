# 光伏发电可视化更新说明

## 更新时间
2025年12月31日

## 更新内容

已将**光伏发电可视化**添加到园区能耗分析图表中。

### 更新的图表文件
📊 **文件**: [results/figures/virtual_park/park_energy_analysis.png](results/figures/virtual_park/park_energy_analysis.png)

---

## 图表详细说明

### 子图1: 虚拟园区能耗与光伏发电 - 一周示例

显示一周（168小时）的时间序列数据，包含4条曲线：

1. **实际能耗** (橙红色实线)
   - 显示园区实际能耗
   - 数据来自4种建筑类型的实际测量值

2. **预测能耗** (红色虚线)
   - RF Lite模型预测的能耗
   - 用于验证模型准确性

3. **光伏发电** (金色粗线) ⭐ **新增**
   - 基于天气数据GHI（全球水平辐照度）计算
   - 装机容量: 20.12 MW
   - 公式: `发电量 = GHI × 光伏板面积 × 效率 × (1 - 系统损失)`
   - 白天高峰可达6000+ kWh/h

4. **净负荷** (钢蓝色点线) ⭐ **新增**
   - 净负荷 = 能耗 - 光伏发电
   - 负值表示光伏发电超过能耗（可向电网输电）
   - 正值表示需要从电网取电

**关键发现**:
- ☀️ 光伏发电在白天11:00-15:00达到峰值（晴天可达6000+ kWh/h）
- 🌙 夜间光伏发电为0，园区完全依赖电网
- ⚖️ 净负荷在中午可能为负（光伏过剩），需要储能系统或向电网送电

---

### 子图2: 园区日均负荷曲线（能耗 vs 光伏发电）

显示24小时的平均能耗和光伏发电对比：

1. **平均能耗** (橙红色柱状图)
   - 显示每小时的平均能耗
   - 峰值在工作时段（9:00-18:00）

2. **平均光伏发电** (金色柱状图) ⭐ **新增**
   - 显示每小时的平均光伏发电
   - 峰值在正午（11:00-13:00）

3. **净负荷曲线** (钢蓝色折线) ⭐ **新增**
   - 显示每小时的平均净负荷
   - 带圆点标记，便于读取数值

**关键发现**:
- 🌅 早晨6:00-8:00: 能耗上升，光伏刚启动，净负荷高
- ☀️ 正午11:00-14:00: 光伏峰值接近能耗，净负荷最低（部分时段可能为负）
- 🌆 傍晚17:00-19:00: 能耗峰值，光伏下降，净负荷再次升高
- 🌙 夜间21:00-6:00: 光伏为0，净负荷等于能耗

---

## 技术实现

### 新增函数: `calculate_pv_generation()`

```python
def calculate_pv_generation(datetime_series, pv_capacity_kw):
    """
    计算光伏发电功率
    
    参数:
    - datetime_series: 时间序列
    - pv_capacity_kw: 光伏装机容量(kW)
    
    返回:
    - DataFrame: datetime, pv_generation_kWh
    """
```

**计算公式**:
```
光伏发电(kWh) = GHI(kW/m²) × 光伏板面积(m²) × 效率 × (1 - 系统损失)

其中:
- GHI: 全球水平辐照度（从天气数据获取）
- 光伏板面积 = 装机容量 × 5 m²/kW
- 效率 = 20%
- 系统损失 = 15%
```

### 数据来源

- **天气数据**: `data/WEATHER_DATA_ZURICH_2020_2019.xlsx`
  - GHI列: `GHI[kW/m2]` - 全球水平辐照度
  - 时间分辨率: 1小时
  - 数据年份: 2019年

- **光伏参数**: `PV_PARAMS`字典
  - 装机容量: 20.12 MW
  - 光伏板效率: 20%
  - 系统损失: 15%
  - 光伏板面积: 100,589 m²

---

## 实用价值

### 1. 储能系统设计
通过观察净负荷曲线，可以确定储能系统的最佳容量：
- 中午光伏过剩时充电
- 早晚能耗峰值时放电
- 建议储能容量: 6 MW × 3小时 = 18 MWh

### 2. 需求响应策略
识别可调节负荷的最佳时段：
- ✅ 11:00-14:00: 光伏充足，适合运行高能耗设备
- ❌ 18:00-20:00: 光伏不足，避免高能耗操作

### 3. 电网交互优化
- 光伏过剩时段: 向电网送电获取收益
- 能耗峰值时段: 从电网取电（可能有峰谷电价差）

### 4. 投资决策
直观展示光伏系统的实际贡献：
- 白天可覆盖80-100%的能耗
- 全天平均自给率: 100%（年度视角）
- 验证20.12 MW装机容量的合理性

---

## 使用方法

### 重新生成图表

```bash
python predict_virtual_park.py
```

图表将保存到: `results/figures/virtual_park/park_energy_analysis.png`

### 调整光伏容量

修改 `predict_virtual_park.py` 中的光伏参数：

```python
PV_PARAMS = {
    'panel_efficiency': 0.20,      # 修改效率
    'system_loss': 0.15,           # 修改损失
    'capacity_factor': 0.15,       # 修改容量系数
    # ...
}
```

---

## 相关文件

- 📊 图表: [results/figures/virtual_park/park_energy_analysis.png](results/figures/virtual_park/park_energy_analysis.png)
- 📄 报告: [results/virtual_park/virtual_park_report.txt](results/virtual_park/virtual_park_report.txt)
- 🔧 脚本: [predict_virtual_park.py](predict_virtual_park.py)
- 📖 项目总结: [VIRTUAL_PARK_PROJECT_SUMMARY.md](VIRTUAL_PARK_PROJECT_SUMMARY.md)
- 🚀 快速指南: [VIRTUAL_PARK_QUICKSTART.md](VIRTUAL_PARK_QUICKSTART.md)

---

## 后续优化建议

### 1. 添加季节性分析
- 对比春夏秋冬的光伏发电差异
- 分析冬季自给率下降问题

### 2. 天气场景分析
- 晴天 vs 阴天 vs 雨天的光伏性能
- 计算不同天气下的自给率

### 3. 储能系统仿真
- 添加电池充放电曲线
- 计算储能系统对自给率的提升

### 4. 经济优化
- 计算最优储能容量
- 分析峰谷电价下的经济效益

---

**更新完成！** 🎉

现在你可以直观地看到光伏系统如何在一天中的不同时段贡献能源，以及何时需要电网或储能系统的支持。
